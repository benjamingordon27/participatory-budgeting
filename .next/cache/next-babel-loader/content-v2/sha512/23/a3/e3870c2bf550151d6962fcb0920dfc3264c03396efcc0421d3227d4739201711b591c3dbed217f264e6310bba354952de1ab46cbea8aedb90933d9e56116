{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/benjamingordon/Documents/civic-alley-visualization/data-vis/store/reducers/setMap.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport * as actionTypes from '../actions/actionTypes';\nimport { updateObject } from '../utility';\nimport Spinner from '../../components/UI/Spinner/Spinner';\nimport { translateCategoryText } from '../../util/translateCategory';\nconst DEFAULT_CENTER = {\n  lat: 40.635,\n  lng: -73.94\n};\nconst initialState = {\n  map: /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 9,\n    columnNumber: 10\n  }, this),\n  mapProps: {},\n  zoom: 11,\n  markers: [],\n  center: DEFAULT_CENTER,\n  showDistricts: false,\n  clickedItem: null,\n  url: '/',\n  selectedBudgetItems: null,\n  selectedDistricts: null,\n  action: {},\n  loading: false // item: null, \n\n};\n\nconst setMap = (state, districts, selectedDistricts, councilMembers, selectedBudgetItems) => {\n  return {\n    zoom: state.zoom,\n    districts: districts,\n    selectedDistricts: selectedDistricts,\n    councilMembers: councilMembers,\n    selectedBudgetItems: selectedBudgetItems\n  };\n};\n\nconst zoomMarker = (state, action) => {\n  return updateObject(state, {\n    zoom: 14,\n    center: action.center,\n    clickedItem: action.item\n  });\n};\n\nconst filterBudget = (participatoryBudget, councilMembers, category, year, district, minCost, maxCost, minVotes, maxVotes, councilMember) => {\n  let newBudget = [];\n  let newCouncil = [];\n  Object.keys(participatoryBudget).map(key => {\n    newBudget.push(participatoryBudget[key]);\n  });\n  Object.keys(councilMembers).map(key => {\n    newCouncil.push(councilMembers[key]);\n  });\n  if (year !== '') newBudget = newBudget.filter(item => Number(item.vote_year) === Number(year));\n  if (category !== '') newBudget = newBudget.filter(item => translateCategoryText(item.category) === category);\n  if (district !== '') newBudget = newBudget.filter(item => item.council_district === district);\n  if (minCost !== '') newBudget = newBudget.filter(item => Number(item.cost) >= Number(minCost));\n  if (maxCost !== '') newBudget = newBudget.filter(item => Number(item.cost) <= Number(maxCost));\n  if (minVotes !== '') newBudget = newBudget.filter(item => Number(item.votes) >= Number(minVotes));\n  if (maxVotes !== '') newBudget = newBudget.filter(item => Number(item.votes) <= Number(maxVotes));\n\n  if (councilMember !== '') {\n    var councilMemberNew = councilMember.split(': ')[1];\n    var currDistrict = newCouncil.filter(member => member.name === councilMemberNew)[[0]].district;\n    newBudget = newBudget.filter(item => item.council_district === currDistrict);\n  }\n\n  return newBudget;\n};\n\nconst findItem = (budget, lat, lng, title) => {\n  console.log('findItem', budget, lat, lng, title);\n  var clickedItem = budget.filter(item => Number(item.latitude) === Number(lat) && Number(item.longitude) === Number(lng) && item.title === title)[0];\n  console.log('clickedItem', clickedItem.title, title, clickedItem.title === title);\n  return {\n    clickedItem: clickedItem,\n    center: {\n      latitude: clickedItem.latitude,\n      longitude: clickedItem.longitude\n    },\n    zoom: 14\n  };\n};\n\nconst budgetFilterFromURL = (budget, query) => {\n  let newBudget = [];\n  Object.keys(budget).map(key => {\n    newBudget.push(budget[key]);\n  });\n  if (query.year) newBudget = newBudget.filter(item => Number(item.vote_year) === Number(query.year));\n  if (query.category) newBudget = newBudget.filter(item => translateCategoryText(item.category) === query.category);\n  if (query.district) newBudget = newBudget.filter(item => item.council_district === query.district);\n  if (query.minCost) newBudget = newBudget.filter(item => Number(item.cost) >= Number(query.minCost));\n  if (query.maxCost) newBudget = newBudget.filter(item => Number(item.cost) <= Number(query.maxCost));\n  if (query.minVotes) newBudget = newBudget.filter(item => Number(item.votes) >= Number(query.minVotes));\n  if (query.maxVotes) newBudget = newBudget.filter(item => Number(item.votes) <= Number(query.maxVotes));\n  return {\n    selectedBudgetItems: newBudget\n  };\n};\n\nconst reducer = (state = initialState, action) => {\n  switch (action.type) {\n    case actionTypes.SET_MAP:\n      return updateObject(state, {\n        mapProps: setMap(state, action.districts, action.selectedDistricts, action.councilMembers, action.selectedBudgetItems)\n      });\n\n    case actionTypes.UPDATE_MAP:\n      return updateObject(state, {\n        mapProps: setMap(state, action.districts, action.selectedDistricts, action.councilMembers, action.selectedBudgetItems)\n      });\n\n    case actionTypes.RESET_MAP:\n      return updateObject(state, {\n        map: /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 70\n        }, this),\n        clickedItem: null\n      });\n\n    case actionTypes.ZOOM_MARKER:\n      return zoomMarker(state, action);\n\n    case actionTypes.RESET_CLICKED_ITEM:\n      return updateObject(state, {\n        clickedItem: null,\n        zoom: 11,\n        center: DEFAULT_CENTER\n      });\n\n    case actionTypes.ZOOM_IN:\n      return updateObject(state, {\n        zoom: state.zoom + 1\n      });\n\n    case actionTypes.ZOOM_OUT:\n      return updateObject(state, {\n        zoom: state.zoom - 1\n      });\n\n    case actionTypes.CENTER:\n      console.log('centering!!!');\n      return updateObject(state, {\n        zoom: 11,\n        center: DEFAULT_CENTER,\n        clickedItem: null\n      });\n\n    case actionTypes.SHOW_DISTRICTS:\n      return updateObject(state, {\n        map: /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 75\n        }, this)\n      });\n\n    case actionTypes.BUDGET_FILTER:\n      return updateObject(state, {\n        selectedBudgetItems: filterBudget(action.budget, action.councilMembers, action.category, action.year, action.district, action.minCost, action.maxCost, action.minVotes, action.maxVotes, action.councilMember),\n        action: _objectSpread({}, action),\n        loading: false\n      });\n\n    case actionTypes.BUDGET_FILTER_FROM_URL:\n      return updateObject(state, budgetFilterFromURL(action.budget, action.query));\n\n    case actionTypes.FIND_ITEM:\n      return updateObject(state, ...findItem(action.budget, action.lat, action.lng, action.title));\n\n    default:\n      return state;\n  }\n};\n\nexport default reducer;","map":{"version":3,"sources":["/Users/benjamingordon/Documents/civic-alley-visualization/data-vis/store/reducers/setMap.js"],"names":["actionTypes","updateObject","Spinner","translateCategoryText","DEFAULT_CENTER","lat","lng","initialState","map","mapProps","zoom","markers","center","showDistricts","clickedItem","url","selectedBudgetItems","selectedDistricts","action","loading","setMap","state","districts","councilMembers","zoomMarker","item","filterBudget","participatoryBudget","category","year","district","minCost","maxCost","minVotes","maxVotes","councilMember","newBudget","newCouncil","Object","keys","key","push","filter","Number","vote_year","council_district","cost","votes","councilMemberNew","split","currDistrict","member","name","findItem","budget","title","console","log","latitude","longitude","budgetFilterFromURL","query","reducer","type","SET_MAP","UPDATE_MAP","RESET_MAP","ZOOM_MARKER","RESET_CLICKED_ITEM","ZOOM_IN","ZOOM_OUT","CENTER","SHOW_DISTRICTS","BUDGET_FILTER","BUDGET_FILTER_FROM_URL","FIND_ITEM"],"mappings":"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","sourcesContent":["import * as actionTypes from '../actions/actionTypes';\nimport {updateObject} from '../utility';\nimport Spinner from '../../components/UI/Spinner/Spinner';\nimport {translateCategoryText} from '../../util/translateCategory';\n\nconst DEFAULT_CENTER = { lat: 40.635, lng: -73.94 };\n\nconst initialState = {\n    map: <Spinner />,\n    mapProps: {},\n    zoom: 11,\n    markers: [],\n    center: DEFAULT_CENTER,\n    showDistricts: false,\n    clickedItem: null,\n    url: '/',\n\n    selectedBudgetItems: null,\n    selectedDistricts: null,\n    action: {},    \n    loading: false,\n    // item: null, \n}\n\nconst setMap = (state,districts, selectedDistricts, councilMembers, selectedBudgetItems) => {  \n    \n    return {\n                zoom: state.zoom,\n                districts: districts,\n                selectedDistricts: selectedDistricts,\n                councilMembers: councilMembers,\n                selectedBudgetItems: selectedBudgetItems,                \n            }\n}\n\nconst zoomMarker = (state, action) => {    \n\n    return updateObject (state, {\n        zoom: 14, \n        center: action.center, \n        clickedItem: action.item,        \n    });\n}\n\nconst filterBudget = (participatoryBudget, councilMembers, category, year, district, minCost, maxCost, minVotes, maxVotes, councilMember) => {\n    let newBudget = [];\n    let newCouncil = [];\n    Object.keys(participatoryBudget).map(key => {\n        newBudget.push(participatoryBudget[key])\n    })\n\n    Object.keys(councilMembers).map(key => {\n        newCouncil.push(councilMembers[key])\n    })\n\n\n    if(year !=='')\n        newBudget = newBudget.filter(item => Number(item.vote_year) === Number(year));\n    if(category !=='')\n        newBudget = newBudget.filter(item => translateCategoryText(item.category) === category);    \n    if(district !=='')\n        newBudget = newBudget.filter(item => item.council_district === district);\n    if(minCost !=='')\n        newBudget = newBudget.filter(item => Number(item.cost) >= Number(minCost));\n    if(maxCost !=='')\n        newBudget = newBudget.filter(item => Number(item.cost) <= Number(maxCost));\n    if(minVotes !=='')\n        newBudget = newBudget.filter(item => Number(item.votes) >= Number(minVotes));\n    if(maxVotes !=='')\n        newBudget = newBudget.filter(item => Number(item.votes) <= Number(maxVotes));\n    if(councilMember !==''){                \n        var councilMemberNew = councilMember.split(': ')[1];        \n        var currDistrict = newCouncil.filter(member => member.name === councilMemberNew)[[0]].district;        \n        newBudget = newBudget.filter(item => item.council_district === currDistrict);\n    }    \n\n    return newBudget;\n}\n\nconst findItem = (budget, lat, lng, title) => {  \n    console.log('findItem',budget, lat, lng, title)      \n    var clickedItem = budget.filter(item => Number(item.latitude) === Number(lat) && Number(item.longitude) === Number(lng) && item.title === title)[0];\n    \n    console.log('clickedItem',clickedItem.title, title, clickedItem.title === title);\n    return {\n        clickedItem: clickedItem,\n        center: {latitude: clickedItem.latitude, longitude: clickedItem.longitude},\n        zoom: 14\n    }\n}\n\nconst budgetFilterFromURL = (budget, query) => {\n    let newBudget = [];\n    \n    Object.keys(budget).map(key => {\n        newBudget.push(budget[key])\n    })\n\n    if(query.year)\n        newBudget = newBudget.filter(item => Number(item.vote_year) === Number(query.year));\n    if(query.category)\n        newBudget = newBudget.filter(item => translateCategoryText(item.category) === query.category);    \n    if(query.district)\n        newBudget = newBudget.filter(item => item.council_district === query.district);\n    if(query.minCost)\n        newBudget = newBudget.filter(item => Number(item.cost) >= Number(query.minCost));\n    if(query.maxCost)\n        newBudget = newBudget.filter(item => Number(item.cost) <= Number(query.maxCost));\n    if(query.minVotes)\n        newBudget = newBudget.filter(item => Number(item.votes) >= Number(query.minVotes));\n    if(query.maxVotes)\n        newBudget = newBudget.filter(item => Number(item.votes) <= Number(query.maxVotes));\n\n    return {\n        selectedBudgetItems: newBudget,        \n    }\n}\n\nconst reducer = (state = initialState, action) => {\n    switch(action.type){\n        case actionTypes.SET_MAP: return updateObject(state, {mapProps: setMap(state,action.districts, action.selectedDistricts, action.councilMembers, action.selectedBudgetItems)})        \n        case actionTypes.UPDATE_MAP: return updateObject(state, {mapProps: setMap(state,action.districts, action.selectedDistricts, action.councilMembers, action.selectedBudgetItems)})        \n        case actionTypes.RESET_MAP: return updateObject(state, {map: <Spinner />, clickedItem: null})        \n        case actionTypes.ZOOM_MARKER: return zoomMarker(state, action)\n        case actionTypes.RESET_CLICKED_ITEM: return updateObject(state, {clickedItem: null, zoom: 11, center: DEFAULT_CENTER})\n        case actionTypes.ZOOM_IN: return updateObject(state, {zoom: state.zoom + 1})\n        case actionTypes.ZOOM_OUT: return updateObject(state, {zoom: state.zoom - 1})\n        case actionTypes.CENTER: console.log('centering!!!'); return updateObject(state, {zoom: 11, center: DEFAULT_CENTER, clickedItem: null})\n        case actionTypes.SHOW_DISTRICTS: return updateObject(state, {map: <Spinner />})\n\n        case actionTypes.BUDGET_FILTER: return updateObject(state, {selectedBudgetItems: filterBudget(action.budget, action.councilMembers, action.category, action.year, action.district, action.minCost, action.maxCost, action.minVotes, action.maxVotes, action.councilMember), action: {...action}, loading: false})\n        case actionTypes.BUDGET_FILTER_FROM_URL: return updateObject(state, budgetFilterFromURL(action.budget, action.query))\n        case actionTypes.FIND_ITEM: return updateObject(state, ...findItem(action.budget, action.lat, action.lng, action.title))\n\n        default:\n            return state;\n    }\n}\n\nexport default reducer;"]},"metadata":{},"sourceType":"module"}